<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
    #myCanvas{
        border: 1px solid #ababab;
    }
    #indir{
        color: blue;
        text-decoration: underline;
        cursor: pointer;
    }
</style>
<body>
    <h1>Oy pusulası fotoğrafı yapıcı</h1>
    <p>
        Oy vermek için pusulanın üzerine tıklayın.
    </p>
    <button id="bastan">Baştan başla</button>
    <a id="indir">İndir</a><br/>
    <br>
    <canvas id="my-canvas" width="800" height="600"></canvas>
</body>
<script>

    function loadImage(src, onload) {
        // http://www.thefutureoftheweb.com/blog/image-onload-isnt-being-called
        var img = new Image();

        img.onload = onload;
        img.src = src;

        return img;
    }

    function main() {

        imagesLoaded += 1;

        if(imagesLoaded > 2) {
            var angle =  Math.floor(Math.random() * 10);

            var select =  Math.floor(Math.random() * 3);
            if(select == 0){
                var oybackground = wood1;
            }
            else if(select == 1){

                var oybackground = wood2;
            }
            else if(select == 2){
                var oybackground = wood3;
            }
            else if(select == 3){
                var oybackground = wood4;
            }

            console.log(select);


            // composite now
            ctx.rotate(5*Math.PI/180);
            ctx.drawImage(oybackground, -100, -100);
            ctx.rotate(-5*Math.PI/180);
            //ctx.globalAlpha = 0.5;
            ctx.shadowColor = '#555555'; // green for demo purposes
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.rotate(angle*Math.PI/180);
            ctx.drawImage(img2, canvas.width/2 - img2.width/2, canvas.height/2 - img2.height/2 -50);
            ctx.rotate(-angle*Math.PI/180);
            ctx.restore();
        }
    }



    var imagesLoaded = 0;
    var canvas = document.getElementById("my-canvas");
    var ctx = canvas.getContext("2d");

    var tercih = loadImage('tercih.png', main);

    var wood1 = loadImage('wood1.jpg', main);
    var wood2 = loadImage('wood2.jpg', main);
    var wood3 = loadImage('wood3.jpg', main);
    var wood4 = loadImage('wood4.jpg', main);
    var img2 = loadImage('pusula.png', main);


    document.addEventListener("DOMContentLoaded", function() {

        canvas.addEventListener('click', function(evt) {

            var rect = canvas.getBoundingClientRect();
            var x = evt.clientX - rect.left;
            var y= evt.clientY - rect.top;

            console.log('x:'+x+' y:'+y);
            var angle2 =  Math.floor(Math.random() * 50);


            // draw the image
            // since the context is rotated, the image will be rotated also
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle2*Math.PI/180);
            ctx.drawImage(tercih,0,0,50,50);
            ctx.restore();

        }, false);

        drawCanvas();
    });

    var bastan = document.getElementById("bastan");

    bastan.addEventListener('click', function(evt) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawCanvas();
    });

    var indir = document.getElementById("indir");

    function downloadCanvas(link, canvasId, filename) {
        link.href = document.getElementById(canvasId).toDataURL();
        link.download = filename;
    }

    indir.addEventListener('click', function(evt) {
        downloadCanvas(this, 'my-canvas', 'oy.png');
    });

    function drawCanvas(){
        main();
    }

</script>
</html>